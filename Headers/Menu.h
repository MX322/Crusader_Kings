#include "Headers/Global.h"
#include "Headers/Options.h"
#include "Headers/Intro.h"
//#include "Headers/ClearAll.h"

//MENU MUSIC==================================================
DWORD WINAPI Music_Menu(void* param)
{
    PlaySoundA("Sounds/menu_music.WAV", NULL, SND_LOOP | SND_ASYNC);
    return 0;
}
DWORD WINAPI Button(void* param)
{
    PlaySoundA("Sounds/Button.WAV", NULL, SND_NODEFAULT | SND_ASYNC);
    return 0;
}
//============================================================

void ShowMenu()
{
    bool isOptions = false;
    CONSOLE_FONT_INFOEX font;

    font.cbSize = sizeof(font);
    font.dwFontSize.Y = 35;
    font.FontFamily = FF_DONTCARE;
    font.FontWeight = FW_NORMAL;

    wcscpy_s(font.FaceName, 9, L"Algerian");
    SetCurrentConsoleFontEx(h, 0, &font);

    MoveWindow(GetConsoleWindow(), 220, 80, 1520, 900, true);

    CreateThread(0, 0, Music_Menu, 0, 0, 0);

    const int ROWS = 24;
    const int COLS = 36 * 2;

    string table[ROWS][COLS] = {
        {"\n"},
        {"\n"},
        {"\n"},
        {"\n"},

        {" ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", "-====--====--====-",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " "},

        {"\n"},

        {" ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", "  Start           ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", "\n"} ,

        {" ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", "  Options         ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", "\n"} ,

        {" ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", "  Creators        ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", "\n"} ,

        {" ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", "  Exit            ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " "} ,

        {"\n" },

        {" ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", "-====--====--====-",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " "},

        {"\n"},

        {" ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " "

         "                 ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", "\n"},

        {" ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",

         "                  ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", "\n"},

        {" ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",

         "                  ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", "\n"},

        {" ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",

         "                  ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", "\n"},

        {" ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",

         "                  ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", "\n"},

        {" ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",

         "                  ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", "\n"},

        {" ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",

         "                  ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", "\n"},

        {" ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",

         "                  ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", "\n"},

        {" ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",

         "                  ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", "\n"},

        {" ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",

         "                  ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", "\n"},

        {" ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",

         "                  ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ",
         " ", " ", " ", " ", " ", " ", " ", " ", "\n" }

    };

    for (int y = 0; y < ROWS; y++)
    {
        for (int x = 0; x < COLS; x++)
        {

            // Башня -------------------------

            // кровь
            if (y == 21 && x == 38 || y == 20 && x == 37 || y == 20 && x == 41 || y == 19 && x == 40 || y == 21 && x == 44 ||
                y == 19 && x == 42 || y == 19 && x == 47 || y == 20 && x == 44 || y == 19 && x == 36 || y == 19 && x == 45 ||
                y == 18 && x == 36 || y == 18 && x == 39 || y == 18 && x == 42 || y == 18 && x == 46 || y == 17 && x == 43 ||

                y == 19 && x == 9 || y == 19 && x == 14 || y == 20 && x == 19 || y == 21 && x == 12 || y == 20 && x == 15 ||
                y == 20 && x == 12 || y == 21 && x == 18 || y == 19 && x == 16 || y == 19 && x == 20 || y == 19 && x == 11 ||
                y == 18 && x == 20 || y == 18 && x == 17 || y == 18 && x == 14 || y == 18 && x == 10 || y == 17 && x == 13)
            {
                SetConsoleTextAttribute(h, 4);
                table[y][x] = char(219);
            }

            //отрисовка башни
            else if (y == 4 && x >= 6 && x <= 21 && x % 4 == 0 || y == 4 && x >= 6 && x <= 21 && x % 4 == 1 ||
                y == 6 && x >= 7 && x <= 22 || y == 7 && x >= 7 && x <= 22 ||
                y >= 8 && y <= 9 && x >= 9 && x <= 20 || y >= 11 && y <= 17 && y != 12 && x >= 9 && x <= 20 || 
                y == 18 && x >= 9 && x <= 20 && x != 13 || y == 19 && x == 12 || y == 19 && x == 15 || y == 19 && x == 16 ||
                y == 19 && x == 20 || y == 19 && x == 19 || y == 19 && x == 18 || 
                y == 20 && x == 18 ||

                y == 4 && x >= 33 && x <= 48 && x % 4 == 0 || y == 4 && x >= 34 && x <= 48 && x % 4 == 3 ||
                y == 6 && x >= 34 && x <= 49 || y == 7 && x >= 34 && x <= 49 ||
                y >= 8 && y <= 9 && x >= 36 && x <= 47 || y == 11 && x >= 36 && x <= 47 || y >= 13 && y <= 17 && x >= 36 && x <= 47 ||
                y == 18 && x >= 36 && x <= 47 && x != 43 || y == 19 && x == 36 || y == 19 && x == 37 || y == 19 && x == 38 ||
                y == 19 && x == 40 || y == 19 && x == 41 || y == 19 && x == 44 || y == 20 && x == 38 ) 
            {
                SetConsoleTextAttribute(h, 8);
                table[y][x] = char(219);
            }

           
            // -------------------------------

            else if (y >= (ROWS / 2) - 6 && x == (COLS / 2) - 4 && y < (ROWS / 2) - 2)
            {
                SetConsoleTextAttribute(h, 8);
                table[y][x] = char(254);
            }

            else
            {
                SetConsoleTextAttribute(h, 15);
            }
            cout << table[y][x];

        }
    }


    COORD cursor;
    cursor.X = (COLS / 2) - 4;
    cursor.Y = (ROWS / 2) - 7;



    SetConsoleCursorPosition(h, cursor);

    SetConsoleTextAttribute(h, 4);
    cout << (char)254;

    while (true)
    {
        if (_kbhit())
        {
            int code = _getch();
            // 13 - enter 27 - escape 32 - space up - 72 down - 80 right - 77 left - 75

            if (code == 224)
            {
                code = _getch();
            }

            SetConsoleCursorPosition(h, cursor);

            SetConsoleTextAttribute(h, 8);
            cout << char(254);

            if (code == 72 && cursor.Y - 1 >= (ROWS / 2) - 7)
            {
                cursor.Y--;
            }

            else if (code == 80 && cursor.Y + 1 < (ROWS / 2) - 3)
            {
                cursor.Y++;
            }

            if (code == 13 && cursor.Y == (ROWS / 2) - 7) // Start
            {
                CreateThread(0, 0, Button, 0, 0, 0);
                Sleep(500);
                system("cls");
                StartTitles();
            }

            else if (isOptions == false && code == 13 && cursor.Y == (ROWS / 2) - 6) // Options
            {
                isOptions = true;   //открываем меню
                ShowOptions();
            }

            else if (isOptions == true && code == 13 && cursor.Y == (ROWS / 2) - 6)
            {
                isOptions = false;  //закрываем меню
                Clear(10, 23, 28, 47);
            }

            else if (code == 13 && cursor.Y == (ROWS / 2) - 5) // Creators
            {
                system("start https://github.com/abdu1o");
                system("start https://github.com/MX322");
                system("start https://github.com/byika");
            }

            else if (code == 13 && cursor.Y == (ROWS / 2) - 4) // Exit
            {
                int choice = MessageBoxA(0, "\tAre you sure want to exit?", "The Earth is flat", MB_YESNO);

                if (choice == IDYES)
                {
                    system("cls");
                    exit(0);
                }
            }
            SetConsoleCursorPosition(h, cursor);
            SetConsoleTextAttribute(h, 4);
            cout << char(254);
        }
    }

}